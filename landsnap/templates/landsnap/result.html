{% extends "landsnap/base.html" %}
{% load static i18n %}

{% block content %}
<section class="section results-section">
  <div class="card">
    <h2 class="section-heading">{% trans 'Previous Analysis Results' %}</h2>
    {% if results %}
    <ul class="results-list">
      {% for result in results %}
      <li class="result-item">
        <a href="{% url 'landsnap:analysis_result' result_id=result.upload.result_id %}" class="result-link">
          <div class="result-card">
            <p class="result-date">{{ result.created_at|date:"F j, Y" }}</p>
            <p class="result-change">{{ result.change_percentage }}% {% trans 'Change' %}</p>
            <p class="result-status {% if result.status == 'FAILED' %}status-failed{% elif result.status == 'COMPLETE' %}status-complete{% else %}status-processing{% endif %}">
              {{ result.get_status_display }}
            </p>
            
            {% if result.status == 'COMPLETE' and result.heatmap %}
            <div class="heatmap-preview" 
                 data-before-img="{{ result.upload.image1.url }}"
                 data-after-img="{{ result.upload.image2.url }}"
                 data-heatmap-img="{{ result.heatmap.url }}">
              <div class="heatmap-container" id="heatmap-container-{{ forloop.counter }}"></div>
            </div>
            {% endif %}
          </div>
        </a>
      </li>
      {% endfor %}
    </ul>
    {% else %}
    <p class="no-results">{% trans 'No analysis results yet. Start by uploading images for analysis.' %}</p>
    {% endif %}
  </div>
</section>

<style>
.heatmap-preview {
  margin-top: 1rem;
  height: 100px;
  overflow: hidden;
  position: relative;
}

.heatmap-container {
  width: 100%;
  height: 100%;
  background-size: cover;
  background-position: center;
}

.heatmap-container canvas {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
</style>
{% endblock %}

{% block extra_js %}
<script src="{% static 'landsnap/js/heatmap.js' %}"></script>
{% endblock %}